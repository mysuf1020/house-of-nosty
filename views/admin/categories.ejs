<%- include('../partials/header') %>

<div class="admin-wrapper d-flex">
    <%- include('../partials/admin-sidebar', { activeMenu: 'categories' }) %>
    
    <main class="admin-content flex-grow-1 p-4">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h4 class="fw-bold mb-0">Kelola Kategori</h4>
            <button class="btn btn-warning" data-bs-toggle="modal" data-bs-target="#addCategoryModal">
                <i class="fas fa-plus me-1"></i>Tambah Kategori
            </button>
        </div>
        
        <%- include('../partials/flash-messages') %>
        
        <div class="card border-0 shadow-sm">
            <div class="card-body p-0">
                <table class="table table-hover mb-0">
                    <thead class="table-light">
                        <tr>
                            <th>Icon</th>
                            <th>Nama</th>
                            <th>Urutan</th>
                            <th>Status</th>
                            <th>Aksi</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% categories.forEach(cat => { %>
                        <tr>
                            <td><i class="fas <%= cat.icon %> fa-lg text-warning"></i></td>
                            <td><strong><%= cat.name %></strong></td>
                            <td><%= cat.sort_order %></td>
                            <td>
                                <span class="badge <%= cat.is_active ? 'bg-success' : 'bg-secondary' %>">
                                    <%= cat.is_active ? 'Aktif' : 'Nonaktif' %>
                                </span>
                            </td>
                            <td>
                                <button class="btn btn-sm btn-outline-primary edit-cat-btn" 
                                        data-id="<%= cat.id %>" data-name="<%= cat.name %>" 
                                        data-icon="<%= cat.icon %>" data-order="<%= cat.sort_order %>"
                                        data-active="<%= cat.is_active %>">
                                    <i class="fas fa-edit"></i>
                                </button>
                            </td>
                        </tr>
                        <% }) %>
                    </tbody>
                </table>
            </div>
        </div>
    </main>
</div>

<!-- Add Category Modal -->
<div class="modal fade" id="addCategoryModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <form action="/admin/categories/add" method="POST">
                <div class="modal-header">
                    <h5 class="modal-title">Tambah Kategori</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">Nama Kategori</label>
                        <input type="text" class="form-control" name="name" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Icon (Font Awesome)</label>
                        <input type="text" class="form-control" name="icon" value="fa-tag" placeholder="fa-coffee">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Urutan</label>
                        <input type="number" class="form-control" name="sort_order" value="0">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-warning">Simpan</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Edit Category Modal -->
<div class="modal fade" id="editCategoryModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <form id="editCategoryForm" method="POST">
                <div class="modal-header">
                    <h5 class="modal-title">Edit Kategori</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">Nama Kategori</label>
                        <input type="text" class="form-control" name="name" id="editName" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Icon</label>
                        <input type="text" class="form-control" name="icon" id="editIcon">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Urutan</label>
                        <input type="number" class="form-control" name="sort_order" id="editOrder">
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="is_active" id="editActive">
                        <label class="form-check-label" for="editActive">Aktif</label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-warning">Simpan</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
document.querySelectorAll('.edit-cat-btn').forEach(btn => {
    btn.addEventListener('click', function() {
        document.getElementById('editCategoryForm').action = '/admin/categories/edit/' + this.dataset.id;
        document.getElementById('editName').value = this.dataset.name;
        document.getElementById('editIcon').value = this.dataset.icon;
        document.getElementById('editOrder').value = this.dataset.order;
        document.getElementById('editActive').checked = this.dataset.active === '1';
        new bootstrap.Modal(document.getElementById('editCategoryModal')).show();
    });
});
</script>

<%- include('../partials/footer') %>
